
### **TradesPro 平台架构白皮书：新员工指南**

欢迎加入 TradesPro 团队！本指南旨在帮助你快速理解我们产品的核心架构思想和技术选型，让你能够迅速融入并为这个卓越的平台做出贡献。

#### **1. 我们的核心使命与哲学**

TradesPro 的目标不仅仅是做一个计算器，而是要打造一个**让电气计算更简单、更可靠、更可审计的平台**。为实现这一目标，我们的整个架构都建立在三大基石之上：

  * **离线优先 (Offline-First)**: 我们的用户经常在网络不佳的施工现场工作。因此，所有核心功能必须在完全离线的情况下完美运行。
  * **绝对可审计 (Absolute Auditability)**: 每一次计算都必须是透明、可追溯、可复现的。审计追踪 (Audit Trail) 不是一个附加功能，而是我们系统的核心。
  * **单一事实来源 (Single Source of Truth)**: 无论是前端、后端还是移动端，所有计算逻辑必须源自同一个地方，以保证结果的绝对一致性。

#### **2. 核心架构：共享计算核心 (The Shared Calculation Core)**

我们遇到的最大挑战，也是我们架构最优雅的解决方案，在于如何处理计算逻辑。

**过去的问题：“双引擎风险”**

项目初期，我们在前端 (`useOfflineCalculation.ts`) 和后端微服务 (`cecLoadCalculator.ts`) 中都实现了计算逻辑。这导致了严重的问题：

  * **代码重复**：同样的代码需要写两遍、改两遍。
  * **逻辑不一致**：前端和后端的计算结果可能因为微小差异而不同，这在工程领域是不可接受的。
  * **维护噩梦**：每次法规更新，都需要双倍的工作量和双倍的测试。

**现在的解决方案：“共享计算包” (`@tradespro/calculation-engine`)**

为了根除此问题，我们采用了 **Monorepo 架构**，将所有核心计算逻辑提取到一个独立的、可共享的NPM包中。

```
tradespro/
└── packages/
    └── cec-calculator/          # 目录名: cec-calculator, 包名: @tradespro/calculation-engine
        ├── src/
        │   ├── index.ts         # 导出主函数
        │   └── cec-8-200.ts     # CEC 8-200 核心规则
├── frontend/
│   └── ...                      # 前端应用，导入并使用共享包
└── services/
    └── calculation-service/
        └── ...                  # 后端微服务，也导入并使用同一个共享包
```

这个架构完美地解决了所有问题：

  * **逻辑完全一致**：前端和后端调用的是完全相同的代码。
  * **单一维护点**：所有计算规则的修改只发生在一个地方。
  * 同时保证了**前端可离线工作**和**后端可签名验证**的优点。

#### **3. 技术栈概览**

我们的平台采用现代化的微服务架构，以确保各组件的独立性和可扩展性。

| 组件 | 技术栈 | 职责 |
| :--- | :--- | :--- |
| **前端 (Frontend)** | Quasar / Vue 3 + TypeScript | 负责所有用户交互、UI展示，并执行离线计算。 |
| **后端API (Backend)** | FastAPI (Python) | 负责用户认证、项目管理、云端数据同步和PDF报告生成等非核心计算任务。 |
| **计算引擎 (Calculation Engine)** | Node.js 微服务 | (可选的)在线计算服务，提供可签名的、权威的计算结果。 |
| **数据库 (Database)** | PostgreSQL + Redis | 存储用户、项目数据及计算历史，并提供缓存服务。 |

#### **4. 核心业务逻辑：CEC 8-200 解读**

新员工必须理解，CEC 8-200 规范的核心不是简单的累加，而是一个\*\*“二选一”\*\*的决策过程。

**最终负载 = max(方法a的总负载, 方法b的最小值)**

  * **方法 a) 详细计算法**: 根据房屋面积、供暖、空调等进行详细的负载累加。
  * **方法 b) 最小值法**: 只要房屋面积（不含地下室）超过80m²，其最小服务负载**必须**按24000W (100A) 计算，即使实际计算值远低于此。

**这就是为什么一个150m²的房子，即使没有任何电器，计算结果也必须是100A服务**。我们的代码 `Math.max(calculatedLoadA, minimumLoadB)` 完美地实现了这一核心规则。

#### **5. 用户体验 (UX) 的基石**

我们的架构选择，最终都是为了服务于卓越的用户体验。

  * **响应式界面**: 我们使用 Quasar/Vue3 打造现代化、适配移动端和桌面端的界面。
  * **人性化功能**: 我们提供了诸如**字体大小调整**、**浅色/深色主题切换**和**多语言支持**等功能，以满足不同用户的需求。
  * **交互式工具**: 我们开发了如 **CEC 交互式表格查询**这样的工具，让工程师能以他们熟悉的方式快速查阅规范数据。

#### **6. 你的任务：从这里开始**

作为团队的新成员，你的首要任务是熟悉我们的架构和代码。下一步的行动计划包括：

1.  **完善计算模块**: 基于 `ARCHITECTURE_CONSISTENCY_VERIFICATION.md` 中的规划，创建剩余的纯计算模块（如 `hvacLoadCalculator.ts`）。
2.  **实现计算验证**: 在开发环境中，添加前后端计算对比功能，确保审计记录的一致性。
3.  **完善用户与项目管理**: 熟悉 `FEATURE_SUMMARY.md` 中描述的用户和项目管理功能，并参与后端的API开发和优化。

-----

**总结**

TradesPro 的架构经过深思熟虑，旨在解决电气计算领域的核心痛点。我们通过**共享计算核心**确保了**一致性**，通过**离线优先**确保了**可用性**，通过**完整的审计追踪**确保了**可靠性**。

欢迎你加入这个激动人心的项目，期待你为这个高质量的平台注入新的活力！